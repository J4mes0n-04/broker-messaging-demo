sequenceDiagram
    participant App as Приложение
    participant Producer as Producer
    participant Kafka as Kafka
    participant Callback as Callback

    App->>Producer: send_order(order_id, customer_id, amount)
    Note over App,Producer: Создание сообщения с временной меткой

    Producer->>Kafka: produce(topic='orders', key=order_id, value=json)
    Note over Kafka: Добавлено в партицию

    Kafka-->>Callback: delivery_report (успех/ошибка)
    Callback-->>Producer: Callback выполнен
    Producer->>Producer: poll(timeout=1)
    Note over Producer: Ожидание подтверждения

    Kafka-->>App: Сообщение сохранено в topic

    App->>Producer: flush()
    Note over Producer: Ожидание доставки всех сообщений
    Producer-->>App: Все сообщения подтверждены

    Note over App: Сообщение отправлено в Kafka