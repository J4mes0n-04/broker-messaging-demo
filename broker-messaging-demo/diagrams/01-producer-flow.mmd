sequenceDiagram
    participant App as Application
    participant Producer as Kafka Producer
    participant Kafka as Kafka Broker
    participant Callback as Delivery Callback

    App->>Producer: send_order(order_id, customer_id, amount)
    Note over App,Producer: Create order message with timestamp

    Producer->>Kafka: produce(topic='orders', key=order_id, value=json)
    Note over Kafka: Message enqueued in partition

    Kafka-->>Callback: delivery_report (success/error)
    Callback-->>Producer: Callback executed
    Producer->>Producer: poll(timeout=1)
    Note over Producer: Wait for confirmation

    Kafka-->>App: Message persisted in topic

    App->>Producer: flush()
    Note over Producer: Wait for all messages to be delivered
    Producer-->>App: All messages confirmed

    Note over App: Sequence complete - order sent to Kafka
